<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>騏藝逸品｜靈魂狀態檢測</title>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Styles for Kahoot Vibes -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8f8f8;
            overflow-x: hidden;
        }

        /* 品牌金色定義 */
        :root {
            --brand-gold: #967740;
            --brand-gold-dark: #7a6030;
        }

        .text-brand-gold { color: #967740; }
        .bg-brand-gold { background-color: #967740; }
        .border-brand-gold { border-color: #967740; }

        .kahoot-btn {
            transition: all 0.1s ease-in-out;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }
        .kahoot-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0px 0 rgba(0,0,0,0.1);
        }

        .animate-pop-in {
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            opacity: 0;
            transform: scale(0.8);
        }

        @keyframes popIn {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .bg-pattern {
            /* 淡雅的紋理背景 */
            background-color: #fdfbf7;
            background-image: radial-gradient(#967740 0.5px, transparent 0.5px), radial-gradient(#967740 0.5px, #fdfbf7 0.5px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            opacity: 1;
        }
        
        /* 覆蓋部分背景使其更淡 */
        .bg-pattern::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.92);
            z-index: -1;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons (Implemented as components to avoid CDN issues) ---
        const Icon = ({ size = 24, className = "", children }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const Sparkles = (props) => (
            <Icon {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" /></Icon>
        );
        const Moon = (props) => (
            <Icon {...props}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" /></Icon>
        );
        const Zap = (props) => (
            <Icon {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" /></Icon>
        );
        const Heart = (props) => (
            <Icon {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" /></Icon>
        );
        const Shield = (props) => (
            <Icon {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" /></Icon>
        );
        const Star = (props) => (
            <Icon {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" /></Icon>
        );
        const RefreshCw = (props) => (
            <Icon {...props}>
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
                <path d="M21 3v5h-5" />
                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
                <path d="M8 16H3v5" />
            </Icon>
        );

        // --- Data Definitions ---

        const sections = {
            rest: {
                id: 1,
                title: "第一區：我現在很累",
                subtitle: "情緒安定・休息",
                desc: "當生活把你消耗得很快，你需要的不是再多一點努力，而是一個可以暫時放下的地方。",
                color: "bg-purple-50 text-purple-900 border-purple-200", // Lighter aesthetic
                accent: "bg-purple-500",
                icon: <Moon size={40} />,
                products: ["紫水晶碎石/手串/晶鎮", "白水晶系列 (淨化)", "拉長石/月光石 (溫柔修復)", "薰衣草紫晶", "天青石/透石膏"]
            },
            career: {
                id: 2,
                title: "第二區：我想往前走",
                subtitle: "行動力・事業・轉換",
                desc: "卡住的時候，不是方向錯，而是能量不夠。當你願意跨出第一步，事情才會開始流動。",
                color: "bg-yellow-50 text-yellow-900 border-yellow-200",
                accent: "bg-yellow-500",
                icon: <Zap size={40} />,
                products: ["黃水晶/鈦晶 (招財)", "綠幽靈/異象水晶", "超級七/極光23 (高頻)", "太陽石/金髮晶", "碧璽/黃銅礦"]
            },
            love: {
                id: 3,
                title: "第三區：我需要好好相處",
                subtitle: "人際・感情・溝通",
                desc: "在關係裡，你不需要委屈自己。你只需要被聽懂、被理解。",
                color: "bg-pink-50 text-pink-900 border-pink-200",
                accent: "bg-pink-500",
                icon: <Heart size={40} />,
                products: ["粉水晶 (人緣/桃花)", "草莓晶/紅紋石", "海藍寶/藍晶石 (溝通)", "天河石", "摩根石/孔雀石"]
            },
            protect: {
                id: 4,
                title: "第四區：我想保護自己",
                subtitle: "界線・防護・穩定",
                desc: "當外界太吵、情緒太多，為自己留下一點空間，是一種溫柔的保護。",
                color: "bg-slate-100 text-slate-800 border-slate-300",
                accent: "bg-slate-600",
                icon: <Shield size={40} />,
                products: ["黑曜石/金曜石/銀曜石", "黑髮晶/黑碧璽", "金運石 (強力避邪)", "茶晶 (穩定落地)", "青金石/硃砂"]
            }
        };

        // Note: Keeping option colors (Red/Blue/Yellow/Green) distinct as they are functional for the quiz mechanics
        const questions = [
            {
                step: 1,
                question: "STEP 1｜閉上眼睛深呼吸... 你現在最想調整的狀態是？",
                type: "poll",
                options: [
                    { text: "焦慮、腦袋停不下來", type: "rest", color: "bg-red-500" },
                    { text: "睡不好、容易累", type: "rest", color: "bg-blue-500" },
                    { text: "人際或感情很消耗", type: "love", color: "bg-yellow-500" },
                    { text: "事業卡關 / 金錢壓力", type: "career", color: "bg-green-600" }
                ],
                extraOption: { text: "容易被外界影響、磁場亂", type: "protect", color: "bg-slate-500" } 
            },
            {
                step: 2,
                question: "STEP 2｜目前這個狀況影響你多深？",
                type: "poll",
                options: [
                    { text: "偶爾影響 (最近才開始)", score: 1, color: "bg-red-500" },
                    { text: "已影響情緒與判斷", score: 2, color: "bg-blue-500" },
                    { text: "長期狀態，很想改變", score: 3, color: "bg-yellow-500" },
                    { text: "只是隨緣逛逛", score: 0, color: "bg-green-600" }
                ]
            },
            {
                step: 3,
                question: "STEP 3｜如果有水晶夥伴，你希望它帶給你什麼感覺？",
                type: "poll",
                options: [
                    { text: "情緒穩定、心比較靜", type: "rest", color: "bg-red-500" },
                    { text: "事情順一點、行動力", type: "career", color: "bg-blue-500" },
                    { text: "人際磁場改善", type: "love", color: "bg-yellow-500" },
                    { text: "被保護、比較安心", type: "protect", color: "bg-green-600" }
                ]
            },
            {
                step: 4,
                question: "STEP 4｜你通常習慣怎麼使用飾品？",
                type: "poll",
                options: [
                    { text: "每天佩戴", val: "daily", color: "bg-red-500" },
                    { text: "偶爾佩戴", val: "occasional", color: "bg-blue-500" },
                    { text: "放包包 / 床邊 / 桌上", val: "place", color: "bg-yellow-500" },
                    { text: "還不確定", val: "unsure", color: "bg-green-600" }
                ]
            },
            {
                step: 5,
                question: "STEP 5｜今天，你準備好為自己做多少改變？(預算)",
                type: "poll",
                options: [
                    { text: "先穩定就好 ($680 入門)", val: "680", color: "bg-red-500" },
                    { text: "穩定＋推進 ($980 進階)", val: "980", color: "bg-blue-500" },
                    { text: "一次調整到位 ($1280 完整)", val: "1280", color: "bg-yellow-500" },
                    { text: "顧問協助 / 客製化", val: "custom", color: "bg-green-600" }
                ]
            }
        ];

        // --- Components ---

        const WelcomeScreen = ({ onStart }) => (
            <div className="flex flex-col items-center justify-center min-h-screen bg-pattern p-6 text-center animate-pop-in relative z-10">
                <div className="bg-white p-8 rounded-3xl shadow-xl max-w-md w-full border-b-8 border-[#967740]">
                    <div className="mb-6 flex justify-center text-[#967740]">
                        <Sparkles size={64} />
                    </div>
                    <h1 className="text-3xl font-black text-gray-800 mb-4 tracking-tight">
                        騏藝逸品<br/><span className="text-[#967740] text-2xl">靈魂狀態檢測</span>
                    </h1>
                    <p className="text-gray-600 mb-8 font-medium leading-relaxed">
                        花 1 分鐘，讓我們幫你找到現在最需要的水晶夥伴，補充你缺失的能量。
                    </p>
                    <button 
                        onClick={onStart}
                        className="w-full bg-[#967740] text-white text-xl font-bold py-4 rounded-xl shadow-lg hover:bg-[#7a6030] transition-transform active:scale-95 border-b-4 border-[#7a6030]"
                    >
                        開始測驗
                    </button>
                    <p className="mt-4 text-xs text-gray-400 tracking-widest">QI YI CRYSTAL</p>
                </div>
            </div>
        );

        const QuestionScreen = ({ questionData, onAnswer, currentStep, totalSteps }) => {
            const displayOptions = questionData.step === 1 
                ? [...questionData.options, questionData.extraOption]
                : questionData.options;

            return (
                <div className="flex flex-col min-h-screen bg-[#967740] text-white">
                    {/* Header Bar */}
                    <div className="flex justify-between items-center p-4 bg-black/10">
                        <div className="bg-white/20 px-4 py-1 rounded-full text-sm font-bold backdrop-blur-sm">
                            {currentStep} / {totalSteps}
                        </div>
                        <div className="font-bold tracking-wider opacity-90">QI YI CRYSTAL</div>
                    </div>

                    {/* Question Area */}
                    <div className="flex-1 flex items-center justify-center p-6 text-center">
                        <div className="bg-white text-gray-900 p-8 rounded-2xl shadow-2xl max-w-2xl w-full border-b-8 border-[#d4c5a9] animate-pop-in">
                            <h2 className="text-2xl md:text-3xl font-black text-[#5c4a28]">{questionData.question}</h2>
                        </div>
                    </div>

                    {/* Options Area (Kahoot Style Grid) */}
                    <div className="p-4 grid grid-cols-1 md:grid-cols-2 gap-4 pb-8 max-w-4xl mx-auto w-full">
                        {displayOptions.map((opt, idx) => (
                            <button
                                key={idx}
                                onClick={() => onAnswer(opt)}
                                className={`
                                    ${opt.color} 
                                    kahoot-btn
                                    text-white text-lg md:text-xl font-bold 
                                    p-6 md:p-8 rounded-xl shadow-md 
                                    flex items-center justify-between
                                    border-b-4 border-black/20
                                    ${questionData.step === 1 && idx === 4 ? 'md:col-span-2' : ''} 
                                `}
                            >
                                <div className="flex items-center gap-3 text-left w-full">
                                    <span className="bg-black/20 w-8 h-8 flex items-center justify-center rounded text-sm shrink-0">
                                        {idx === 0 ? '▲' : idx === 1 ? '◆' : idx === 2 ? '●' : idx === 3 ? '■' : '★'}
                                    </span>
                                    <span>{opt.text}</span>
                                </div>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const ResultScreen = ({ result, userSelections, onRestart }) => {
            const sectionData = sections[result];

            // Determine intensity
            const intensity = userSelections.q2_score >= 2 ? "能量急需補充" : "能量微調保養";
            
            // Get Budget/Determination
            const budgetMap = {
                "680": "入門 ($680)",
                "980": "進階 ($980)",
                "1280": "完整 ($1280)",
                "custom": "客製化"
            };
            const userBudget = budgetMap[userSelections.budget] || "未定";

            return (
                <div className="min-h-screen bg-[#fdfbf7] p-4 md:p-8 flex items-center justify-center">
                    <div className="max-w-4xl w-full bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row animate-pop-in border border-[#e8dfcc]">
                        
                        {/* Left Side: Result Card */}
                        <div className={`md:w-5/12 p-8 flex flex-col justify-between relative overflow-hidden ${sectionData.color}`}>
                            
                            <div className="relative z-10">
                                <div className="inline-block px-3 py-1 bg-white/60 rounded-full text-xs font-bold mb-4 tracking-widest uppercase text-gray-600">
                                    Your Energy Analysis
                                </div>
                                <h2 className="text-4xl font-black mb-2 tracking-tight">{sectionData.title}</h2>
                                <h3 className="text-xl font-medium opacity-80 mb-6">{sectionData.subtitle}</h3>
                                <div className="bg-white/40 p-4 rounded-xl backdrop-blur-sm border border-white/50 mb-6">
                                    <p className="text-sm leading-relaxed font-medium">
                                        "{sectionData.desc}"
                                    </p>
                                </div>
                            </div>
                            
                            <div className="relative z-10 text-center mt-4">
                                <div className={`bg-white p-4 rounded-full inline-block shadow-lg mb-2 text-[#967740]`}>
                                    {sectionData.icon}
                                </div>
                                <div className="font-bold text-lg opacity-80">檢測結果</div>
                            </div>
                        </div>

                        {/* Right Side: Details & Action */}
                        <div className="md:w-7/12 p-8 bg-white text-gray-800 flex flex-col">
                            
                            {/* Consultant Note (Top Info) */}
                            <div className="bg-[#fcfbf9] rounded-xl p-4 mb-6 border border-[#e8dfcc]">
                                <h4 className="text-xs font-bold text-[#967740] uppercase tracking-wide mb-2">顧問參考資訊</h4>
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <span className="block text-xs text-gray-400">當前狀態強度</span>
                                        <span className={`block font-bold ${userSelections.q2_score >= 2 ? 'text-red-500' : 'text-gray-600'}`}>
                                            {intensity}
                                        </span>
                                    </div>
                                    <div>
                                        <span className="block text-xs text-gray-400">期望調整方案</span>
                                        <span className="block font-bold text-[#967740]">{userBudget}</span>
                                    </div>
                                </div>
                            </div>

                            {/* Recommendations */}
                            <div className="flex-1">
                                <h3 className="text-xl font-bold mb-4 flex items-center gap-2 text-gray-800">
                                    <Star className="text-[#967740]" size={20}/> 推薦水晶品項
                                </h3>
                                <ul className="space-y-3 mb-8">
                                    {sectionData.products.map((prod, idx) => (
                                        <li key={idx} className="flex items-start gap-3 p-3 rounded-lg hover:bg-[#fdfbf7] transition-colors border border-transparent hover:border-[#e8dfcc]">
                                            <div className={`mt-1 w-2 h-2 rounded-full shrink-0 ${sectionData.accent}`}></div>
                                            <span className="font-medium text-gray-600">{prod}</span>
                                        </li>
                                    ))}
                                </ul>
                            </div>

                            {/* CTA Button */}
                            <div className="mt-auto pt-4 border-t border-gray-100">
                                <p className="text-center text-sm text-gray-400 mb-4">
                                    請將此畫面出示給現場顧問，我們將引導您前往該區域。
                                </p>
                                <button 
                                    onClick={onRestart}
                                    className="w-full flex items-center justify-center gap-2 bg-[#967740] text-white font-bold py-3 rounded-xl hover:bg-[#7a6030] transition-colors shadow-lg"
                                >
                                    <RefreshCw size={18} /> 重新測驗
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App Logic ---

        const App = () => {
            const [screen, setScreen] = useState('welcome'); // welcome, quiz, result
            const [currentQIndex, setCurrentQIndex] = useState(0);
            const [answers, setAnswers] = useState({
                mainType: null, // From Q1
                q2_score: 0,
                desiredType: null, // From Q3
                habit: null,
                budget: null
            });

            const handleStart = () => {
                setScreen('quiz');
                setCurrentQIndex(0);
                setAnswers({ mainType: null, q2_score: 0, desiredType: null, habit: null, budget: null });
            };

            const handleAnswer = (option) => {
                const currentStep = questions[currentQIndex].step;
                
                setAnswers(prev => {
                    const newAnswers = { ...prev };
                    if (currentStep === 1) newAnswers.mainType = option.type;
                    if (currentStep === 2) newAnswers.q2_score = option.score;
                    if (currentStep === 3) newAnswers.desiredType = option.type;
                    if (currentStep === 4) newAnswers.habit = option.val;
                    if (currentStep === 5) newAnswers.budget = option.val;
                    return newAnswers;
                });

                if (currentQIndex < questions.length - 1) {
                    setTimeout(() => {
                        setCurrentQIndex(prev => prev + 1);
                    }, 200);
                } else {
                    setTimeout(() => {
                        setScreen('result');
                    }, 200);
                }
            };

            const getResultType = () => {
                return answers.mainType || 'rest'; 
            };

            return (
                <div className="antialiased text-gray-900">
                    {screen === 'welcome' && <WelcomeScreen onStart={handleStart} />}
                    {screen === 'quiz' && (
                        <QuestionScreen 
                            questionData={questions[currentQIndex]} 
                            onAnswer={handleAnswer}
                            currentStep={currentQIndex + 1}
                            totalSteps={questions.length}
                        />
                    )}
                    {screen === 'result' && (
                        <ResultScreen 
                            result={getResultType()} 
                            userSelections={answers}
                            onRestart={() => setScreen('welcome')}
                        />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
